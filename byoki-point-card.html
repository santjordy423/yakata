<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>âœ¦</text></svg>">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä½“èª¿ä¸è‰¯ãƒã‚¤ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ â€” æ€ æƒ°ãªé›‘ç¨®ã¨ç‹ã®é¤¨</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Special+Elite&family=Courier+Prime:wght@400;700&display=swap');

  :root {
    --cream: #f5f0e8;
    --paper: #faf7f2;
    --ink: #1a1a2e;
    --ink-light: #3d3d5c;
    --red: #c0392b;
    --red-light: #e74c3c;
    --gray: #7f8c8d;
    --gray-light: #bdc3c7;
    --border: #2c2c4a;
    --stamp-blue: #2563a8;
    --stamp-red: #c0392b;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #d4c9b0;
    background-image: 
      repeating-linear-gradient(0deg, transparent, transparent 24px, rgba(0,0,0,0.03) 24px, rgba(0,0,0,0.03) 25px),
      repeating-linear-gradient(90deg, transparent, transparent 24px, rgba(0,0,0,0.02) 24px, rgba(0,0,0,0.02) 25px);
    min-height: 100vh;
    font-family: 'Courier Prime', monospace;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  /* ===== ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ï¼ˆå‡¦æ–¹ç®‹é¢¨ï¼‰ ===== */
  .prescription {
    background: var(--paper);
    width: 100%;
    max-width: 560px;
    border: 1px solid #c8b89a;
    box-shadow: 3px 3px 0 #b0a080, 6px 6px 0 #9a8860, 2px 2px 20px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
  }

  /* ç”¨ç´™ã®è³ªæ„Ÿ */
  .prescription::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='400' height='400' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
  }

  .prescription-header {
    background: var(--ink);
    color: var(--cream);
    padding: 14px 20px 10px;
    position: relative;
    border-bottom: 4px double var(--cream);
  }

  .clinic-name {
    font-family: 'Special Elite', serif;
    font-size: 11px;
    letter-spacing: 3px;
    opacity: 0.7;
    text-transform: uppercase;
  }

  .rx-symbol {
    font-family: 'Special Elite', serif;
    font-size: 32px;
    line-height: 1;
    float: right;
    opacity: 0.6;
    margin-top: -4px;
  }

  .prescription-title {
    font-family: 'Noto Serif JP', serif;
    font-size: 22px;
    font-weight: 700;
    letter-spacing: 2px;
    margin-top: 4px;
  }

  /* æ‚£è€…æƒ…å ±æ¬„ */
  .patient-info {
    padding: 12px 20px;
    border-bottom: 1px solid #c8b89a;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    background: rgba(255,255,255,0.5);
    position: relative;
    z-index: 1;
  }

  .info-field {
    font-size: 10px;
    color: var(--gray);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .info-value {
    font-family: 'Special Elite', serif;
    font-size: 13px;
    color: var(--ink);
    border-bottom: 1px solid var(--gray-light);
    padding-bottom: 2px;
    min-height: 20px;
  }

  /* ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ */
  .rank-section {
    padding: 16px 20px;
    border-bottom: 2px dashed #c8b89a;
    display: flex;
    align-items: center;
    gap: 16px;
    position: relative;
    z-index: 1;
  }

  .rank-badge {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    border: 3px solid var(--ink);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
    background: var(--paper);
    box-shadow: inset 0 0 0 2px var(--cream), 0 2px 8px rgba(0,0,0,0.2);
    transition: all 0.5s;
  }

  .rank-badge.bronze { border-color: #cd7f32; color: #cd7f32; }
  .rank-badge.silver { border-color: #8e9eab; color: #8e9eab; }
  .rank-badge.gold { border-color: #c9a84c; color: #c9a84c; }
  .rank-badge.platinum { border-color: #4a90a4; color: #4a90a4; }

  .rank-badge-icon { font-size: 22px; line-height: 1; }
  .rank-badge-name { font-size: 8px; letter-spacing: 1px; margin-top: 2px; font-weight: 700; }

  .rank-details { flex: 1; }
  .rank-label { font-size: 9px; color: var(--gray); letter-spacing: 2px; text-transform: uppercase; }
  .rank-name { font-family: 'Noto Serif JP', serif; font-size: 16px; font-weight: 700; color: var(--ink); margin: 2px 0; }
  .rank-desc { font-size: 10px; color: var(--ink-light); }

  .points-display {
    text-align: right;
  }
  .points-label { font-size: 9px; color: var(--gray); letter-spacing: 1px; text-transform: uppercase; }
  .points-total { font-family: 'Special Elite', serif; font-size: 28px; color: var(--ink); line-height: 1; }
  .points-unit { font-size: 10px; color: var(--gray); }

  /* ä»Šæ—¥ã®è¨ºæ–­ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ */
  .diagnosis-section {
    padding: 12px 20px;
    border-bottom: 2px dashed #c8b89a;
    position: relative;
    z-index: 1;
    display: none;
  }
  .diagnosis-section.visible { display: block; }

  .diagnosis-name {
    font-family: 'Noto Serif JP', serif;
    font-size: 17px;
    font-weight: 700;
    color: var(--ink);
    letter-spacing: 1px;
    margin-bottom: 10px;
  }
  .diagnosis-name span {
    font-size: 10px;
    color: var(--gray);
    font-weight: 400;
    letter-spacing: 2px;
    display: block;
    margin-bottom: 2px;
    font-family: 'Courier Prime', monospace;
  }

  .receptionist-comment {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    margin-top: 8px;
    padding: 10px 12px;
    background: rgba(255,255,255,0.6);
    border: 1px solid #d8ccb8;
  }
  .receptionist-icon {
    font-size: 22px;
    flex-shrink: 0;
    line-height: 1;
  }
  .receptionist-body { flex: 1; }
  .receptionist-name {
    font-size: 9px;
    color: var(--gray);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 3px;
  }
  .receptionist-text {
    font-family: 'Noto Serif JP', serif;
    font-size: 12px;
    color: var(--ink);
    line-height: 1.7;
  }

  /* ä»Šæ—¥ã®ãƒã‚¤ãƒ³ãƒˆ */
  .today-section {
    padding: 12px 20px;
    border-bottom: 1px solid #c8b89a;
    position: relative;
    z-index: 1;
  }

  .section-label {
    font-size: 9px;
    color: var(--gray);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--gray-light);
  }

  .today-items {
    min-height: 40px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .today-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    color: var(--ink);
    padding: 2px 0;
    animation: slideIn 0.3s ease;
  }
  .today-item-name { }
  .today-item-pt { font-family: 'Special Elite', serif; color: var(--red); font-size: 14px; }

  .today-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid var(--ink);
    font-weight: 700;
  }
  .today-total-label { font-size: 11px; letter-spacing: 1px; }
  .today-total-pt { font-family: 'Special Elite', serif; font-size: 20px; color: var(--red); }

  .empty-today {
    font-size: 11px;
    color: var(--gray);
    font-style: italic;
    text-align: center;
    padding: 8px 0;
  }

  /* é€²æ—ãƒãƒ¼ */
  .progress-section {
    padding: 10px 20px 14px;
    border-bottom: 2px dashed #c8b89a;
    position: relative;
    z-index: 1;
  }

  .progress-bar-wrap {
    background: var(--gray-light);
    height: 8px;
    border-radius: 0;
    margin-top: 6px;
    position: relative;
    border: 1px solid #9a9a9a;
  }
  .progress-bar-fill {
    background: repeating-linear-gradient(90deg, var(--ink) 0px, var(--ink) 8px, transparent 8px, transparent 12px);
    height: 100%;
    transition: width 0.8s cubic-bezier(0.4,0,0.2,1);
  }
  .progress-labels {
    display: flex;
    justify-content: space-between;
    font-size: 9px;
    color: var(--gray);
    margin-top: 4px;
  }

  /* å¤±åŠ¹è­¦å‘Š */
  .expiry-warning {
    padding: 6px 20px;
    background: #fff3cd;
    border-bottom: 1px solid #ffc107;
    font-size: 10px;
    color: #856404;
    display: flex;
    align-items: center;
    gap: 6px;
    position: relative;
    z-index: 1;
  }
  .expiry-warning.danger { background: #f8d7da; border-color: var(--red); color: var(--red); }
  .expiry-warning.hidden { display: none; }

  /* ç—‡çŠ¶é¸æŠã‚¨ãƒªã‚¢ */
  .symptoms-section {
    padding: 14px 20px;
    position: relative;
    z-index: 1;
  }

  .symptom-categories { display: flex; flex-direction: column; gap: 12px; }

  .category-title {
    font-size: 9px;
    color: var(--gray);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .symptom-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .symptom-btn {
    background: var(--paper);
    border: 1px solid var(--ink);
    color: var(--ink);
    font-family: 'Courier Prime', monospace;
    font-size: 11px;
    padding: 4px 10px;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 0.5px;
    position: relative;
    white-space: nowrap;
  }

  .symptom-btn:hover {
    background: var(--ink);
    color: var(--cream);
  }

  .symptom-btn.fever-btn { border-color: var(--red); color: var(--red); }
  .symptom-btn.fever-btn:hover { background: var(--red); color: white; }

  .symptom-btn.disease-btn { border-color: var(--stamp-blue); color: var(--stamp-blue); }
  .symptom-btn.disease-btn:hover { background: var(--stamp-blue); color: white; }

  .symptom-btn .pt-badge {
    font-size: 9px;
    opacity: 0.6;
    margin-left: 4px;
  }

  /* ç™ºç†±ã‚µãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
  .fever-sub {
    display: none;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 6px;
    padding: 8px;
    border: 1px dashed var(--red);
    background: #fff5f5;
  }
  .fever-sub.open { display: flex; }
  .fever-sub .symptom-btn { border-color: var(--red); color: var(--red); font-size: 10px; }
  .fever-sub .symptom-btn:hover { background: var(--red); color: white; }

  /* ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆã‚¹ã‚¿ãƒ³ãƒ—æ¬„é¢¨ï¼‰ */
  .prescription-footer {
    padding: 12px 20px;
    border-top: 2px double var(--ink);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 1;
    background: rgba(255,255,255,0.3);
  }

  .footer-note {
    font-size: 9px;
    color: var(--gray);
    line-height: 1.6;
  }

  .doctor-stamp {
    width: 64px;
    height: 64px;
    border: 2px solid var(--stamp-red);
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--stamp-red);
    font-size: 8px;
    letter-spacing: 1px;
    text-align: center;
    opacity: 0.7;
    transform: rotate(-12deg);
    font-family: 'Special Elite', serif;
    padding: 4px;
    line-height: 1.4;
  }

  /* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ */
  .toast {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(-60px);
    background: var(--ink);
    color: var(--cream);
    padding: 10px 20px;
    font-family: 'Courier Prime', monospace;
    font-size: 12px;
    letter-spacing: 1px;
    transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
    z-index: 1000;
    white-space: nowrap;
    border: 1px solid var(--cream);
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* å‡¦æ–¹æ—¥ */
  .date-stamp {
    font-family: 'Special Elite', serif;
    font-size: 11px;
    color: var(--stamp-blue);
    opacity: 0.8;
    text-align: right;
    padding: 0 20px 6px;
    position: relative;
    z-index: 1;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  /* é¸æŠæ¸ˆã¿ãƒœã‚¿ãƒ³ */
  .symptom-btn.selected {
    background: var(--ink);
    color: var(--cream);
    opacity: 0.5;
    cursor: not-allowed;
    position: relative;
  }
  .symptom-btn.selected::after {
    content: 'âœ“';
    margin-left: 4px;
    font-size: 10px;
  }
  .symptom-btn.fever-btn.selected {
    background: var(--red);
    color: white;
    opacity: 0.5;
    cursor: not-allowed;
  }
  .symptom-btn.disease-btn.selected {
    background: var(--stamp-blue);
    color: white;
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
  .reset-btn {
    background: none;
    border: 1px solid var(--gray-light);
    color: var(--gray);
    font-family: 'Courier Prime', monospace;
    font-size: 9px;
    padding: 3px 8px;
    cursor: pointer;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-top: 4px;
  }
  .reset-btn:hover { border-color: var(--red); color: var(--red); }

  /* é¤¨ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
  .back-btn {
    position: fixed; top: 16px; left: 16px; z-index: 100;
    background: rgba(250,247,242,.92); border: 1px solid #b0a080;
    color: var(--ink-light); font-family: 'Courier Prime', monospace;
    font-size: .75rem; letter-spacing: .1em; padding: 7px 14px;
    cursor: pointer; transition: all .2s; backdrop-filter: blur(4px);
    text-decoration: none; display: inline-block;
    box-shadow: 2px 2px 0 #b0a080;
  }
  .back-btn:hover { border-color: var(--ink); color: var(--ink); background: var(--paper); }

  /* ãƒªã‚»ãƒƒãƒˆç¢ºèªã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
  .reset-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 2000;
    align-items: center;
    justify-content: center;
  }
  .reset-dialog {
    background: var(--paper);
    border: 2px solid var(--ink);
    padding: 24px 28px;
    max-width: 300px;
    width: 90%;
    font-family: 'Courier Prime', monospace;
    box-shadow: 4px 4px 0 var(--ink);
  }
  .reset-dialog-title {
    font-family: 'Noto Serif JP', serif;
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--red);
  }
  .reset-dialog-body {
    font-size: 11px;
    color: var(--ink-light);
    margin-bottom: 16px;
    line-height: 1.7;
  }
  .reset-dialog-btns {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
  }
  .reset-dialog-btns button {
    font-family: 'Courier Prime', monospace;
    font-size: 11px;
    padding: 5px 14px;
    border: 1px solid var(--ink);
    cursor: pointer;
    letter-spacing: 1px;
  }
  .btn-cancel { background: var(--paper); color: var(--ink); }
  .btn-cancel:hover { background: var(--gray-light); }
  .btn-confirm { background: var(--red); color: white; border-color: var(--red); }
  .btn-confirm:hover { background: #a93226; }
</style>
</head>
<body>

<a class="back-btn" href="index.html">â† é¤¨ã¸æˆ»ã‚‹</a>

<div class="prescription">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="prescription-header">
    <div class="clinic-name">Fuguai Clinic â€” Member Card</div>
    <span class="rx-symbol">â„</span>
    <div class="prescription-title">ä½“èª¿ä¸è‰¯ãƒã‚¤ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰</div>
  </div>

  <!-- æ‚£è€…æƒ…å ± -->
  <div class="patient-info">
    <div>
      <div class="info-field">Patient / æ‚£è€…å</div>
      <div class="info-value" id="patientName">â€”</div>
    </div>
    <div>
      <div class="info-field">Member No. / ä¼šå“¡ç•ªå·</div>
      <div class="info-value" id="memberNo">â€”</div>
    </div>
  </div>

  <!-- ãƒ©ãƒ³ã‚¯ -->
  <div class="rank-section">
    <div class="rank-badge" id="rankBadge">
      <div class="rank-badge-icon" id="rankIcon">ğŸ¥</div>
      <div class="rank-badge-name" id="rankBadgeName">ä¸€èˆ¬</div>
    </div>
    <div class="rank-details">
      <div class="rank-label">Current Rank</div>
      <div class="rank-name" id="rankName">æ–°è¦æ‚£è€…</div>
      <div class="rank-desc" id="rankDesc">ã‚ˆã†ã“ãã€ä¸èª¿ã®ä¸–ç•Œã¸</div>
      <button class="reset-btn" onclick="confirmReset()">[ ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ ]</button>
    </div>
    <div class="points-display">
      <div class="points-label">ç´¯è¨ˆ</div>
      <div class="points-total" id="totalPoints">0</div>
      <div class="points-unit">pt</div>
    </div>
  </div>

  <!-- ä»Šæ—¥ã®è¨ºæ–­ãƒ»å—ä»˜ã‚³ãƒ¡ãƒ³ãƒˆ -->
  <div class="diagnosis-section" id="diagnosisSection">
    <div class="section-label">æœ¬æ—¥ã®è¨ºæ–­</div>
    <div class="diagnosis-name">
      <span>Diagnosis</span>
      <span id="diagnosisName">â€”</span>
    </div>
    <div class="receptionist-comment">
      <div class="receptionist-icon" id="receptionistIcon">ğŸ‘©</div>
      <div class="receptionist-body">
        <div class="receptionist-name" id="receptionistName">å—ä»˜</div>
        <div class="receptionist-text" id="receptionistText">â€”</div>
      </div>
    </div>
  </div>

  <!-- ä»Šæ—¥ã®ãƒã‚¤ãƒ³ãƒˆ -->
  <div class="today-section">
    <div class="section-label">æœ¬æ—¥ã®å‡¦æ–¹è¨˜éŒ²</div>
    <div class="today-items" id="todayItems">
      <div class="empty-today">æœ¬æ—¥ã®ä¸èª¿ã¯ã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>
    </div>
    <div class="today-total" id="todayTotal" style="display:none">
      <span class="today-total-label">æœ¬æ—¥åˆè¨ˆ</span>
      <span class="today-total-pt" id="todayTotalPt">0 pt</span>
    </div>
  </div>

  <!-- é€²æ—ãƒãƒ¼ -->
  <div class="progress-section">
    <div class="section-label">æ¬¡ã®ãƒ©ãƒ³ã‚¯ã¾ã§</div>
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
    </div>
    <div class="progress-labels">
      <span id="progressCurrent">0 pt</span>
      <span id="progressNext">æ¬¡: ãƒ–ãƒ­ãƒ³ã‚º 100pt</span>
    </div>
  </div>

  <!-- å¤±åŠ¹è­¦å‘Š -->
  <div class="expiry-warning hidden" id="expiryWarning">
    âš  <span id="expiryText"></span>
  </div>

  <!-- å‡¦æ–¹æ—¥ -->
  <div class="date-stamp" id="dateStamp"></div>

  <!-- ç—‡çŠ¶é¸æŠ -->
  <div class="symptoms-section">
    <div class="section-label">ç—‡çŠ¶ã‚’é¸æŠã—ã¦è¨˜éŒ²</div>
    <div class="symptom-categories">

      <!-- å®šç•ª -->
      <div>
        <div class="category-title">â–¸ å®šç•ªç—‡çŠ¶</div>
        <div class="symptom-grid">
          <button class="symptom-btn" data-name="é ­ç—›" onclick="addSymptom('é ­ç—›',15)">é ­ç—›<span class="pt-badge">15pt</span></button>
          <button class="symptom-btn" data-name="å€¦æ€ æ„Ÿ" onclick="addSymptom('å€¦æ€ æ„Ÿ',10)">å€¦æ€ æ„Ÿ<span class="pt-badge">10pt</span></button>
          <button class="symptom-btn" data-name="åãæ°—" onclick="addSymptom('åãæ°—',15)">åãæ°—<span class="pt-badge">15pt</span></button>
          <button class="symptom-btn" data-name="è…¹ç—›" onclick="addSymptom('è…¹ç—›',15)">è…¹ç—›<span class="pt-badge">15pt</span></button>
          <button class="symptom-btn" data-name="ä¸‹ç—¢" onclick="addSymptom('ä¸‹ç—¢',20)">ä¸‹ç—¢<span class="pt-badge">20pt</span></button>
          <button class="symptom-btn" data-name="é¼»æ°´" onclick="addSymptom('é¼»æ°´',8)">é¼»æ°´<span class="pt-badge">8pt</span></button>
          <button class="symptom-btn" data-name="å’³" onclick="addSymptom('å’³',10)">å’³<span class="pt-badge">10pt</span></button>
          <button class="symptom-btn" data-name="å–‰ã®ç—›ã¿" onclick="addSymptom('å–‰ã®ç—›ã¿',10)">å–‰ã®ç—›ã¿<span class="pt-badge">10pt</span></button>
          <button class="symptom-btn" data-name="ã‚ã¾ã„" onclick="addSymptom('ã‚ã¾ã„',15)">ã‚ã¾ã„<span class="pt-badge">15pt</span></button>
        </div>
      </div>

      <!-- ç™ºç†± -->
      <div>
        <div class="category-title">â–¸ ç™ºç†±ï¼ˆã‚¿ãƒƒãƒ—ã§è©³ç´°ï¼‰</div>
        <div class="symptom-grid">
          <button class="symptom-btn fever-btn" onclick="toggleFever()">ç™ºç†± ğŸŒ¡ï¸<span class="pt-badge">â–¾</span></button>
        </div>
        <div class="fever-sub" id="feverSub">
          <button class="symptom-btn" data-name="å¾®ç†± (37åº¦å°)" data-group="fever" onclick="addSymptom('å¾®ç†± (37åº¦å°)',20)">å¾®ç†± 37åº¦å°<span class="pt-badge">20pt</span></button>
          <button class="symptom-btn" data-name="ç™ºç†± (38åº¦å°)" data-group="fever" onclick="addSymptom('ç™ºç†± (38åº¦å°)',35)">ç™ºç†± 38åº¦å°<span class="pt-badge">35pt</span></button>
          <button class="symptom-btn" data-name="é«˜ç†± (39åº¦ä»¥ä¸Š)" data-group="fever" onclick="addSymptom('é«˜ç†± (39åº¦ä»¥ä¸Š)',50)">é«˜ç†± 39åº¦+<span class="pt-badge">50pt</span></button>
        </div>
      </div>

      <!-- è‚©è…°ç³» -->
      <div>
        <div class="category-title">â–¸ è‚©ãƒ»è…°ãƒ»ãã®ä»–ã®ç—›ã¿</div>
        <div class="symptom-grid">
          <button class="symptom-btn" data-name="è‚©ã“ã‚Š" onclick="addSymptom('è‚©ã“ã‚Š',8)">è‚©ã“ã‚Š<span class="pt-badge">8pt</span></button>
          <button class="symptom-btn" data-name="è…°ç—›" onclick="addSymptom('è…°ç—›',12)">è…°ç—›<span class="pt-badge">12pt</span></button>
          <button class="symptom-btn" data-name="é¦–ã“ã‚Š" onclick="addSymptom('é¦–ã“ã‚Š',8)">é¦–ã“ã‚Š<span class="pt-badge">8pt</span></button>
          <button class="symptom-btn" data-name="çœ¼ç²¾ç–²åŠ´" onclick="addSymptom('çœ¼ç²¾ç–²åŠ´',8)">çœ¼ç²¾ç–²åŠ´<span class="pt-badge">8pt</span></button>
          <button class="symptom-btn" data-name="è†ã®ç—›ã¿" onclick="addSymptom('è†ã®ç—›ã¿',12)">è†ã®ç—›ã¿<span class="pt-badge">12pt</span></button>
          <button class="symptom-btn" data-name="é–¢ç¯€ç—›" onclick="addSymptom('é–¢ç¯€ç—›',15)">é–¢ç¯€ç—›<span class="pt-badge">15pt</span></button>
          <button class="symptom-btn" data-name="ç”Ÿç†ç—›" onclick="addSymptom('ç”Ÿç†ç—›',20)">ç”Ÿç†ç—›<span class="pt-badge">20pt</span></button>
          <button class="symptom-btn" data-name="æ­¯ç—›" onclick="addSymptom('æ­¯ç—›',15)">æ­¯ç—›<span class="pt-badge">15pt</span></button>
          <button class="symptom-btn" data-name="è€³é³´ã‚Š" onclick="addSymptom('è€³é³´ã‚Š',10)">è€³é³´ã‚Š<span class="pt-badge">10pt</span></button>
          <button class="symptom-btn" data-name="ç›®ãŒã‹ã™ã‚€" onclick="addSymptom('ç›®ãŒã‹ã™ã‚€',8)">ç›®ãŒã‹ã™ã‚€<span class="pt-badge">8pt</span></button>
        </div>
      </div>

      <!-- ç—…åç³» -->
      <div>
        <div class="category-title">â–¸ è¨ºæ–­å</div>
        <div class="symptom-grid">
          <button class="symptom-btn disease-btn" data-name="ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶A" onclick="addSymptom('ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶A',60)">ã‚¤ãƒ³ãƒ•ãƒ«A<span class="pt-badge">60pt</span></button>
          <button class="symptom-btn disease-btn" data-name="ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶B" onclick="addSymptom('ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶B',60)">ã‚¤ãƒ³ãƒ•ãƒ«B<span class="pt-badge">60pt</span></button>
          <button class="symptom-btn disease-btn" data-name="COVID-19" onclick="addSymptom('COVID-19',60)">COVID-19<span class="pt-badge">60pt</span></button>
          <button class="symptom-btn disease-btn" data-name="è¿·èµ°ç¥çµŒåå°„" onclick="addSymptom('è¿·èµ°ç¥çµŒåå°„',40)">è¿·èµ°ç¥çµŒåå°„<span class="pt-badge">40pt</span></button>
          <button class="symptom-btn disease-btn" data-name="åé ­ç—›" onclick="addSymptom('åé ­ç—›',30)">åé ­ç—›<span class="pt-badge">30pt</span></button>
          <button class="symptom-btn disease-btn" data-name="è²§è¡€" onclick="addSymptom('è²§è¡€',25)">è²§è¡€<span class="pt-badge">25pt</span></button>
          <button class="symptom-btn disease-btn" data-name="èƒƒè…¸ç‚" onclick="addSymptom('èƒƒè…¸ç‚',40)">èƒƒè…¸ç‚<span class="pt-badge">40pt</span></button>
          <button class="symptom-btn disease-btn" data-name="æ‰æ¡ƒç‚" onclick="addSymptom('æ‰æ¡ƒç‚',35)">æ‰æ¡ƒç‚<span class="pt-badge">35pt</span></button>
        </div>
      </div>

      <!-- ãµã‚ã£ã¨ç³» -->
      <div>
        <div class="category-title">â–¸ ãªã‚“ã¨ãªãç³»</div>
        <div class="symptom-grid">
          <button class="symptom-btn" data-name="ãªã‚“ã‹æ€ ã„" onclick="addSymptom('ãªã‚“ã‹æ€ ã„',5)">ãªã‚“ã‹æ€ ã„<span class="pt-badge">5pt</span></button>
          <button class="symptom-btn" data-name="ãƒ¡ãƒ³ã‚¿ãƒ«ãŒã—ã‚“ã©ã„" onclick="addSymptom('ãƒ¡ãƒ³ã‚¿ãƒ«ãŒã—ã‚“ã©ã„',5)">ãƒ¡ãƒ³ã‚¿ãƒ«ãŒã—ã‚“ã©ã„<span class="pt-badge">5pt</span></button>
          <button class="symptom-btn" data-name="æ°—åŠ›ãŒãªã„" onclick="addSymptom('æ°—åŠ›ãŒãªã„',5)">æ°—åŠ›ãŒãªã„<span class="pt-badge">5pt</span></button>
          <button class="symptom-btn" data-name="å¯ã™ããŸ" onclick="addSymptom('å¯ã™ããŸ',5)">å¯ã™ããŸ<span class="pt-badge">5pt</span></button>
          <button class="symptom-btn" data-name="èŠ±ç²‰ç—‡" onclick="addSymptom('èŠ±ç²‰ç—‡',8)">èŠ±ç²‰ç—‡<span class="pt-badge">8pt</span></button>
        </div>
      </div>

    </div>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
  <div class="prescription-footer">
    <div class="footer-note">
      â€» 1ãƒ¶æœˆé–“ã®ä¸è¨˜éŒ²ã«ã‚ˆã‚Šãƒ©ãƒ³ã‚¯å¤±åŠ¹<br>
      â€» ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆã‚‚ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™<br>
      â€» å½“ã‚«ãƒ¼ãƒ‰ã¯æ¶ç©ºã®ãƒã‚¤ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã§ã™
    </div>
    <div class="doctor-stamp" id="doctorStamp">
      FUGUAI<br>CLINIC<br>èªå®š
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="reset-overlay" id="resetOverlay">
  <div class="reset-dialog">
    <div class="reset-dialog-title">âš  ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</div>
    <div class="reset-dialog-body">
      å…¨ã¦ã®è¨˜éŒ²ãƒ»ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆãƒ»ãƒ©ãƒ³ã‚¯ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚<br>
      ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚
    </div>
    <div class="reset-dialog-btns">
      <button class="btn-cancel" onclick="cancelReset()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn-confirm" onclick="doReset()">ãƒªã‚»ãƒƒãƒˆã™ã‚‹</button>
    </div>
  </div>
</div>

<script>
// ===== å—ä»˜ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ =====
const RECEPTIONISTS = [
  {
    name: 'ç”°ä¸­ã•ã‚“ï¼ˆãƒ™ãƒ†ãƒ©ãƒ³ãƒ»ç„¡æ„›æƒ³ï¼‰',
    icon: 'ğŸ‘©â€ğŸ’¼',
    comments: [
      { max: 0,   text: 'ä»Šæ—¥ã¯ä½•ã‚‚ãªã„ã‚“ã§ã™ã‹ã€‚ã§ã¯ä½•ã—ã«æ¥ãŸã‚“ã§ã™ã‹ã€‚' },
      { max: 15,  text: 'ç—…ã¯æ°—ã‹ã‚‰ã€ã§ã™ã€‚ç²¾ç¥åŠ›ã§ä½•ã¨ã‹ã—ã¦ãã ã•ã„ã€‚' },
      { max: 30,  text: 'â€¦ãã‚Œãã‚‰ã„ã§æ¥ã¾ã™ã‹ã€æ™®é€šã€‚æ¬¡ã®æ–¹ã©ã†ãã€‚' },
      { max: 50,  text: 'ã¾ã‚ã€ä¼‘ã‚“ã§ã„ã„ã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ã€‚è²¬ä»»ã¯æŒã¡ã¾ã›ã‚“ãŒã€‚' },
      { max: 80,  text: 'æ—©ãå¯ãªã•ã„ã€‚è©±ã¯ãã‚Œã‹ã‚‰ã§ã™ã€‚' },
      { max: 120, text: 'ä»Šã™ãç—…é™¢ã«è¡Œã£ã¦ãã ã•ã„ã€‚ã“ã“ã¯æ¶ç©ºã®å—ä»˜ã§ã™ã€‚' },
      { max: 200, text: 'ã‚ˆãä»Šæ—¥ã‚‚ç”Ÿãã¦æ¥ã‚‰ã‚Œã¾ã—ãŸã­ã€‚æ„Ÿå¿ƒã—ã¾ã™ã€‚' },
      { max: Infinity, text: 'å…¥é™¢ã—ã¦ãã ã•ã„ã€‚ãªã‚“ãªã‚‰ä»Šæ—¥ã‹ã‚‰ã€‚' },
    ]
  },
  {
    name: 'ä½è—¤ã•ã‚“ï¼ˆæ–°äººãƒ»å„ªã—ã„ï¼‰',
    icon: 'ğŸ‘§',
    comments: [
      { max: 0,   text: 'ãŠä½“ã®èª¿å­ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿä½•ã‹ã‚ã‚Œã°ã„ã¤ã§ã‚‚ã©ã†ãï¼' },
      { max: 15,  text: 'ã‚ã¾ã‚Šç„¡ç†ã—ãªã„ã§ãã ã•ã„ã­ã€‚å°‘ã—ãŠä¼‘ã¿ã‚’å–ã‚‹ã®ã‚‚å¤§äº‹ã§ã™ã€‚' },
      { max: 30,  text: 'ãŠä½“ã¤ã‚‰ã„ã§ã™ã‚ˆã­â€¦ã€‚ä»Šæ—¥ã¯ã‚†ã£ãã‚Šä¼‘ã‚“ã§ãã ã•ã„ã€‚' },
      { max: 50,  text: 'ãã‚Œã¯å¤§å¤‰ã§ã—ãŸã­ã€‚æš–ã‹ãã—ã¦ã€ã—ã£ã‹ã‚Šä¼‘ã‚“ã§ãã ã•ã„ã€‚' },
      { max: 80,  text: 'æ—©ã‚ã«ä¼‘ã‚“ã§ãã ã•ã„ã­ã€‚ãŠä½“ãŒå¿ƒé…ã§ã™â€¦ã€‚' },
      { max: 120, text: 'ã“ã‚Œã¯â€¦æ—©ã‚ã«ç—…é™¢ã«è¡Œã‹ã‚ŒãŸæ–¹ãŒã‚ˆã„ã‹ã¨æ€ã„ã¾ã™ã€‚ãŠå¤§äº‹ã«ã€‚' },
      { max: 200, text: 'ãŠä½“å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿæœ¬å½“ã«ã‚ˆãé ‘å¼µã£ã¦ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã™ã­â€¦ã€‚' },
      { max: Infinity, text: 'ã“ã‚“ãªã«é ‘å¼µã‚‰ãªãã¦ã„ã„ã‚“ã§ã™ã‚ˆâ€¦ã€‚ã‚†ã£ãã‚Šä¼‘ã‚“ã§ãã ã•ã„ã€‚' },
    ]
  },
];

// ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã«ãƒ©ãƒ³ãƒ€ãƒ ã§å—ä»˜ã‚’æ±ºã‚ã‚‹
let _receptionist = null;
function getReceptionist() {
  if (!_receptionist) {
    _receptionist = RECEPTIONISTS[Math.floor(Math.random() * RECEPTIONISTS.length)];
  }
  return _receptionist;
}

function getComment(receptionist, pt) {
  return receptionist.comments.find(c => pt <= c.max)?.text || receptionist.comments.at(-1).text;
}

// ===== è¨ºæ–­å =====
function getDiagnosis(items) {
  if (!items || items.length === 0) return null;
  const names = items.map(i => i.name);

  const hasFever = names.some(n => n.includes('ç†±'));
  const hasHeadache = names.includes('é ­ç—›') || names.includes('åé ­ç—›');
  const hasStomach = names.some(n => ['è…¹ç—›','åãæ°—','ä¸‹ç—¢','èƒƒè…¸ç‚'].includes(n));
  const hasMental = names.some(n => ['ãƒ¡ãƒ³ã‚¿ãƒ«ãŒã—ã‚“ã©ã„','æ°—åŠ›ãŒãªã„','ãªã‚“ã‹æ€ ã„'].includes(n));
  const hasDesk = names.some(n => ['è‚©ã“ã‚Š','é¦–ã“ã‚Š','çœ¼ç²¾ç–²åŠ´','ç›®ãŒã‹ã™ã‚€'].includes(n));
  const hasPollen = names.includes('èŠ±ç²‰ç—‡');
  const hasInfluA = names.includes('ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶A');
  const hasInfluB = names.includes('ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶B');
  const hasInflu = hasInfluA || hasInfluB;
  const hasCovid = names.includes('COVID-19');
  const hasVagal = names.includes('è¿·èµ°ç¥çµŒåå°„');
  const hasBack = names.some(n => ['è…°ç—›','è†ã®ç—›ã¿','é–¢ç¯€ç—›'].includes(n));
  const hasDizzy = names.includes('ã‚ã¾ã„');

  if (hasInfluA) return 'Aå‹ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶æ„ŸæŸ“ç—‡';
  if (hasInfluB) return 'Bå‹ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶æ„ŸæŸ“ç—‡';
  if (hasCovid) return 'COVID-19æ„ŸæŸ“ç—‡';
  if (hasVagal) return 'è¿·èµ°ç¥çµŒåå°„æ€§å¤±ç¥';
  if (hasFever && hasHeadache && hasStomach) return 'ç·åˆä¸èª¿ç—‡å€™ç¾¤ï¼ˆé‡ç—‡ï¼‰';
  if (hasFever && hasHeadache) return 'æ€¥æ€§ç†±æ€§é ­ç—›ç—‡';
  if (hasFever && hasStomach) return 'ç™ºç†±æ€§èƒƒè…¸ç‚';
  if (hasFever) return 'æ€¥æ€§ç™ºç†±ç—‡';
  if (hasStomach && hasDizzy) return 'è‡ªå¾‹ç¥çµŒå¤±èª¿ç—‡ï¼ˆæ¶ˆåŒ–å™¨å‹ï¼‰';
  if (hasStomach) return 'æ€¥æ€§èƒƒè…¸éšœå®³';
  if (hasDesk && hasHeadache) return 'ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚«ãƒ¼ç—…ï¼ˆé ­ç—›åˆä½µå‹ï¼‰';
  if (hasDesk && hasMental) return 'æ…¢æ€§ç–²åŠ´ç—‡å€™ç¾¤ï¼ˆãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯å‹ï¼‰';
  if (hasDesk) return 'ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚«ãƒ¼ç—…';
  if (hasBack) return 'æ…¢æ€§ç­‹éª¨æ ¼ç³»ç–¼ç—›ç—‡';
  if (hasPollen) return 'å­£ç¯€æ€§ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ€§é¼»ç‚ï¼ˆé‡ç—‡ï¼‰';
  if (hasMental && names.length === 1) return 'æ…¢æ€§æ€ æƒ°ç—‡';
  if (hasMental) return 'å¿ƒèº«ç–²å¼Šç—‡å€™ç¾¤';
  if (hasHeadache) return 'ç·Šå¼µæ€§é ­ç—›ç—‡';
  return 'åŸå› ä¸æ˜ã®è¤‡åˆä¸èª¿ç—‡';
}

// ===== ãƒ‡ãƒ¼ã‚¿ =====
const RANKS = [
  { name: 'æ–°è¦æ‚£è€…',    desc: 'ã‚ˆã†ã“ãã€ä¸èª¿ã®ä¸–ç•Œã¸',         min: 0,    max: 99,   badge: 'ğŸ¥', cls: '' },
  { name: 'å¸¸é€£æ‚£è€…',    desc: 'ãŠé¡”ã‚’å­˜ã˜ã¦ãŠã‚Šã¾ã™',           min: 100,  max: 299,  badge: 'ğŸ¥‰', cls: 'bronze' },
  { name: 'é¡”ãªã˜ã¿',   desc: 'å—ä»˜ã•ã‚“ã«åå‰ã§å‘¼ã°ã‚Œã¾ã™',     min: 300,  max: 599,  badge: 'ğŸ¥ˆ', cls: 'silver' },
  { name: 'ä¸»æ²»åŒ»ã«åå‰ã‚’è¦šãˆã‚‰ã‚ŒãŸ', desc: 'æ‹…å½“åŒ»ãŒå¤‰ã‚ã‚‹ã¨å°‘ã—ä¸å®‰', min: 600, max: 999, badge: 'ğŸ¥‡', cls: 'gold' },
  { name: 'ç—…é™¢ã®äººã«å¿ƒé…ã•ã‚Œã‚‹',  desc: 'ã€Œã¾ãŸæ¥ã¾ã—ãŸã­â€¦ã€',  min: 1000, max: Infinity, badge: 'ğŸ’', cls: 'platinum' },
];

function getData() {
  const d = localStorage.getItem('byoki_data');
  if (d) return JSON.parse(d);
  return {
    totalPoints: 0,
    todayPoints: 0,
    todayItems: [],
    lastRecordDate: null,
    lastActiveDate: null,
    memberNo: 'B-' + String(Math.floor(Math.random()*90000)+10000),
    registeredAt: new Date().toISOString(),
  };
}

function saveData(data) {
  localStorage.setItem('byoki_data', JSON.stringify(data));
}

function getToday() {
  return new Date().toISOString().slice(0,10);
}

// æ—¥ä»˜ãŒå¤‰ã‚ã£ã¦ã„ãŸã‚‰ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
function checkDayReset(data) {
  const today = getToday();
  if (data.lastRecordDate && data.lastRecordDate !== today) {
    data.todayPoints = 0;
    data.todayItems = [];
  }
  return data;
}

// 1ãƒ¶æœˆä¸è¨˜éŒ²ãƒã‚§ãƒƒã‚¯
function checkExpiry(data) {
  if (!data.lastActiveDate) return null;
  const last = new Date(data.lastActiveDate);
  const now = new Date();
  const diff = Math.floor((now - last) / (1000*60*60*24));
  if (diff >= 30) return 'expired';
  if (diff >= 20) return `ã‚ã¨${30-diff}æ—¥ã§å¤±åŠ¹ï¼ˆãƒ©ãƒ³ã‚¯ãƒ»ç´¯è¨ˆãƒªã‚»ãƒƒãƒˆï¼‰`;
  return null;
}

function applyExpiry(data) {
  if (!data.lastActiveDate) return data;
  const last = new Date(data.lastActiveDate);
  const now = new Date();
  const diff = Math.floor((now - last) / (1000*60*60*24));
  if (diff >= 30) {
    data.totalPoints = 0;
    data.todayPoints = 0;
    data.todayItems = [];
  }
  return data;
}

function getRank(pts) {
  for (let i = RANKS.length-1; i >= 0; i--) {
    if (pts >= RANKS[i].min) return RANKS[i];
  }
  return RANKS[0];
}

function render() {
  let data = getData();
  data = applyExpiry(data);
  data = checkDayReset(data);
  saveData(data);

  // æ‚£è€…æƒ…å ±
  document.getElementById('memberNo').textContent = data.memberNo;
  document.getElementById('patientName').textContent = 'â€”';

  // æ—¥ä»˜
  const now = new Date();
  document.getElementById('dateStamp').textContent = 
    `å‡¦æ–¹æ—¥: ${now.getFullYear()}å¹´${now.getMonth()+1}æœˆ${now.getDate()}æ—¥`;

  // ãƒ©ãƒ³ã‚¯
  const rank = getRank(data.totalPoints);
  const badge = document.getElementById('rankBadge');
  badge.className = 'rank-badge ' + rank.cls;
  document.getElementById('rankIcon').textContent = rank.badge;
  document.getElementById('rankBadgeName').textContent = rank.cls.toUpperCase() || 'ä¸€èˆ¬';
  document.getElementById('rankName').textContent = rank.name;
  document.getElementById('rankDesc').textContent = rank.desc;
  document.getElementById('totalPoints').textContent = data.totalPoints.toLocaleString();

  // ä»Šæ—¥ã®è¨˜éŒ²
  const itemsEl = document.getElementById('todayItems');
  const totalEl = document.getElementById('todayTotal');
  if (data.todayItems && data.todayItems.length > 0) {
    itemsEl.innerHTML = data.todayItems.map(it =>
      `<div class="today-item"><span class="today-item-name">${it.name}</span><span class="today-item-pt">+${it.pt} pt</span></div>`
    ).join('');
    totalEl.style.display = 'flex';
    document.getElementById('todayTotalPt').textContent = data.todayPoints + ' pt';
  } else {
    itemsEl.innerHTML = '<div class="empty-today">æœ¬æ—¥ã®ä¸èª¿ã¯ã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
    totalEl.style.display = 'none';
  }

  // è¨ºæ–­åãƒ»å—ä»˜ã‚³ãƒ¡ãƒ³ãƒˆ
  const diagSection = document.getElementById('diagnosisSection');
  const diagnosis = getDiagnosis(data.todayItems);
  if (diagnosis && data.todayItems.length > 0) {
    diagSection.classList.add('visible');
    document.getElementById('diagnosisName').textContent = diagnosis;
    const rec = getReceptionist();
    document.getElementById('receptionistIcon').textContent = rec.icon;
    document.getElementById('receptionistName').textContent = rec.name;
    document.getElementById('receptionistText').textContent = getComment(rec, data.todayPoints);
  } else {
    diagSection.classList.remove('visible');
  }

  // é€²æ—ãƒãƒ¼
  const nextRankIdx = RANKS.findIndex(r => r.min > data.totalPoints);
  if (nextRankIdx === -1) {
    document.getElementById('progressBar').style.width = '100%';
    document.getElementById('progressCurrent').textContent = data.totalPoints + ' pt';
    document.getElementById('progressNext').textContent = 'MAX RANK é”æˆ';
  } else {
    const prev = RANKS[nextRankIdx-1]?.min || 0;
    const next = RANKS[nextRankIdx].min;
    const pct = Math.min(100, ((data.totalPoints - prev) / (next - prev)) * 100);
    document.getElementById('progressBar').style.width = pct + '%';
    document.getElementById('progressCurrent').textContent = data.totalPoints + ' pt';
    document.getElementById('progressNext').textContent = `æ¬¡: ${RANKS[nextRankIdx].name} ${next}pt`;
  }

  // é¸æŠæ¸ˆã¿ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
  const selectedNames = new Set((data.todayItems || []).map(it => it.name));
  const feverGroups = ['å¾®ç†± (37åº¦å°)', 'ç™ºç†± (38åº¦å°)', 'é«˜ç†± (39åº¦ä»¥ä¸Š)'];
  const feverSelected = feverGroups.some(n => selectedNames.has(n));

  document.querySelectorAll('.symptom-btn[data-name]').forEach(btn => {
    const name = btn.dataset.name;
    const isGroup = btn.dataset.group === 'fever';
    const disabled = selectedNames.has(name) || (isGroup && feverSelected);
    if (disabled) {
      btn.classList.add('selected');
      btn.disabled = true;
    } else {
      btn.classList.remove('selected');
      btn.disabled = false;
    }
  });

  // å¤±åŠ¹è­¦å‘Š
  const expiryStatus = checkExpiry(data);
  const warningEl = document.getElementById('expiryWarning');
  if (expiryStatus === 'expired') {
    warningEl.classList.remove('hidden');
    warningEl.classList.add('danger');
    document.getElementById('expiryText').textContent = 'ãƒ©ãƒ³ã‚¯ãƒ»ç´¯è¨ˆãƒã‚¤ãƒ³ãƒˆãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚ä¹…ã—ã¶ã‚Šã§ã™ã­ã€ãŠå…ƒæ°—ã§ã—ãŸã‹ï¼Ÿ';
  } else if (expiryStatus) {
    warningEl.classList.remove('hidden', 'danger');
    document.getElementById('expiryText').textContent = expiryStatus;
  } else {
    warningEl.classList.add('hidden');
  }
}

function addSymptom(name, pt) {
  let data = getData();
  data = checkDayReset(data);
  const today = getToday();

  if (!data.todayItems) data.todayItems = [];

  // å½“æ—¥ã™ã§ã«é¸æŠæ¸ˆã¿ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
  if (data.todayItems.some(it => it.name === name)) {
    showToast(`${name} ã¯æœ¬æ—¥ã™ã§ã«è¨˜éŒ²æ¸ˆã¿ã§ã™`);
    return;
  }

  // ç™ºç†±ã‚°ãƒ«ãƒ¼ãƒ—ã¯1ã¤ã ã‘
  const btn = document.querySelector(`[data-name="${name}"]`);
  if (btn && btn.dataset.group === 'fever') {
    const feverGroups = ['å¾®ç†± (37åº¦å°)', 'ç™ºç†± (38åº¦å°)', 'é«˜ç†± (39åº¦ä»¥ä¸Š)'];
    if (data.todayItems.some(it => feverGroups.includes(it.name))) {
      showToast('ç™ºç†±ã¯1æ—¥1ç¨®é¡ã¾ã§è¨˜éŒ²ã§ãã¾ã™');
      return;
    }
  }

  data.todayItems.push({ name, pt });
  data.todayPoints = (data.todayPoints || 0) + pt;
  data.totalPoints = (data.totalPoints || 0) + pt;
  data.lastRecordDate = today;
  data.lastActiveDate = today;
  saveData(data);

  showToast(`${name} +${pt}pt è¨˜éŒ²ã—ã¾ã—ãŸ`);
  render();
}

function toggleFever() {
  const sub = document.getElementById('feverSub');
  sub.classList.toggle('open');
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

function confirmReset() {
  const overlay = document.getElementById('resetOverlay');
  overlay.style.display = 'flex';
}

function doReset() {
  localStorage.removeItem('byoki_data');
  document.getElementById('resetOverlay').style.display = 'none';
  render();
  showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
}

function cancelReset() {
  document.getElementById('resetOverlay').style.display = 'none';
}

render();
</script>
</body>
</html>
