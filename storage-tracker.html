<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¿å­˜é£Ÿç®¡ç† â€” æ€ æƒ°ãªé›‘ç¨®ã¨ç‹ã®é¤¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: linear-gradient(160deg,#060d18 0%,#0a1628 60%,#060d18 100%); min-height: 100vh; }
  .back-link {
    position: fixed; top: 16px; left: 16px; z-index: 100;
    color: rgba(100,180,255,0.5); font-size: 0.75rem; text-decoration: none;
    font-family: 'Noto Sans JP', sans-serif; letter-spacing: 0.1em;
    transition: color 0.2s;
  }
  .back-link:hover { color: #90c8f8; }
</style>
</head>
<body>
<a href="index.html" class="back-link">â† ã‚‚ã©ã‚‹</a>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const SAMPLE_DATA = [
  { id: 1, name: "æ°´ï¼ˆ2Lï¼‰", expiry: "2031-05", location: "3éš", qty: 24, unit: "æœ¬" },
  { id: 2, name: "ã‚¢ãƒ«ãƒ•ã‚¡ç±³", expiry: "2028-03", location: "æŠ¼ã—å…¥ã‚Œ", qty: 10, unit: "è¢‹" },
  { id: 3, name: "ç¼¶è©°ï¼ˆã‚µãƒï¼‰", expiry: "2026-06", location: "1éš", qty: 6, unit: "ç¼¶" },
  { id: 4, name: "ä¹¾ãƒ‘ãƒ³", expiry: "2026-04", location: "æŠ¼ã—å…¥ã‚Œ", qty: 3, unit: "ç®±" },
];

function getMonthsUntilExpiry(expiry) {
  const [y, m] = expiry.split("-").map(Number);
  const now = new Date();
  return (y - now.getFullYear()) * 12 + (m - now.getMonth() - 1);
}

function ExpiryBadge({ expiry }) {
  const months = getMonthsUntilExpiry(expiry);
  const [y, m] = expiry.split("-");
  const label = `${y}å¹´${parseInt(m)}æœˆ`;
  if (months < 0) return <span style={{ background:"rgba(255,50,80,0.2)", border:"1px solid rgba(255,50,80,0.5)", color:"#ff5060", borderRadius:6, padding:"2px 8px", fontSize:"0.72rem", fontWeight:700 }}>âš  æœŸé™åˆ‡ã‚Œ</span>;
  if (months <= 6) return <span style={{ background:"rgba(255,80,80,0.15)", border:"1px solid rgba(255,80,80,0.4)", color:"#ff6060", borderRadius:6, padding:"2px 8px", fontSize:"0.72rem" }}>ğŸ”´ {label}</span>;
  if (months <= 12) return <span style={{ background:"rgba(255,180,50,0.15)", border:"1px solid rgba(255,180,50,0.4)", color:"#ffb832", borderRadius:6, padding:"2px 8px", fontSize:"0.72rem" }}>ğŸŸ¡ {label}</span>;
  return <span style={{ background:"rgba(100,220,120,0.1)", border:"1px solid rgba(100,220,120,0.3)", color:"#64dc78", borderRadius:6, padding:"2px 8px", fontSize:"0.72rem" }}>ğŸŸ¢ {label}</span>;
}

function StorageTracker() {
  const [items, setItems] = useState(SAMPLE_DATA);
  const [filter, setFilter] = useState("ã™ã¹ã¦");
  const [sort, setSort] = useState("expiry");
  const [showForm, setShowForm] = useState(false);
  const [editItem, setEditItem] = useState(null);
  const [form, setForm] = useState({ name:"", expiry:"", location:"1éš", qty:"", unit:"å€‹" });
  const [deleteId, setDeleteId] = useState(null);
  const [nextId, setNextId] = useState(10);

  useEffect(() => {
    try {
      const saved = localStorage.getItem("storage-items");
      if (saved) setItems(JSON.parse(saved));
    } catch(e) {}
  }, []);

  function save(newItems) {
    setItems(newItems);
    try { localStorage.setItem("storage-items", JSON.stringify(newItems)); } catch(e) {}
  }

  function openAdd() { setEditItem(null); setForm({ name:"", expiry:"", location:"1éš", qty:"", unit:"å€‹" }); setShowForm(true); }
  function openEdit(item) { setEditItem(item.id); setForm({ name:item.name, expiry:item.expiry, location:item.location, qty:String(item.qty), unit:item.unit }); setShowForm(true); }

  function submitForm() {
    if (!form.name.trim() || !form.expiry) return;
    if (editItem) { save(items.map(i => i.id === editItem ? { ...i, ...form, qty: Number(form.qty) || 0 } : i)); }
    else { save([...items, { id: nextId, ...form, qty: Number(form.qty) || 0 }]); setNextId(nextId + 1); }
    setShowForm(false);
  }

  function deleteItem(id) { save(items.filter(i => i.id !== id)); setDeleteId(null); }

  const allLocations = ["ã™ã¹ã¦", ...Array.from(new Set(items.map(i => i.location)))];
  let displayed = filter === "ã™ã¹ã¦" ? [...items] : items.filter(i => i.location === filter);
  if (sort === "expiry") displayed.sort((a,b) => a.expiry.localeCompare(b.expiry));
  else if (sort === "name") displayed.sort((a,b) => a.name.localeCompare(b.name));
  else if (sort === "location") displayed.sort((a,b) => a.location.localeCompare(b.location));

  const expiringSoon = items.filter(i => getMonthsUntilExpiry(i.expiry) <= 6).length;
  const inp = { background:"rgba(255,255,255,0.06)", border:"1px solid rgba(255,255,255,0.15)", borderRadius:8, padding:"10px 12px", color:"#e8f0f8", fontSize:"0.84rem", fontFamily:"inherit", width:"100%", boxSizing:"border-box" };

  return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#060d18 0%,#0a1628 60%,#060d18 100%)", fontFamily:"'Noto Sans JP', sans-serif", color:"#e8f0f8", padding:"28px 16px 80px" }}>
      <style>{`.item-card:hover { border-color:rgba(100,180,255,0.25) !important; } input:focus,select:focus { outline:none; border-color:rgba(100,180,255,0.5) !important; }`}</style>

      {(showForm || deleteId) && (
        <div style={{ position:"fixed", inset:0, background:"rgba(0,0,0,0.75)", zIndex:50, display:"flex", alignItems:"center", justifyContent:"center", padding:16 }}>
          {showForm && (
            <div style={{ background:"linear-gradient(135deg,#0a1628,#0d1f38)", border:"1px solid rgba(100,180,255,0.2)", borderRadius:16, padding:24, width:"100%", maxWidth:360 }}>
              <div style={{ fontSize:"0.9rem", fontWeight:700, color:"#90c8f8", marginBottom:20 }}>{editItem ? "âœ ç·¨é›†" : "+ æ–°ã—ãç™»éŒ²"}</div>
              <div style={{ display:"flex", flexDirection:"column", gap:12 }}>
                <div><div style={{ fontSize:"0.65rem", color:"rgba(255,255,255,0.4)", marginBottom:5 }}>å“å *</div><input value={form.name} onChange={e=>setForm({...form,name:e.target.value})} placeholder="ä¾‹ï¼šæ°´ï¼ˆ2Lï¼‰" style={inp} /></div>
                <div><div style={{ fontSize:"0.65rem", color:"rgba(255,255,255,0.4)", marginBottom:5 }}>è³å‘³æœŸé™ï¼ˆå¹´-æœˆï¼‰ *</div><input type="month" value={form.expiry} onChange={e=>setForm({...form,expiry:e.target.value})} style={{...inp, colorScheme:"dark"}} /></div>
                <div><div style={{ fontSize:"0.65rem", color:"rgba(255,255,255,0.4)", marginBottom:5 }}>ä¿ç®¡å ´æ‰€</div><input value={form.location} onChange={e=>setForm({...form,location:e.target.value})} placeholder="ä¾‹ï¼šæŠ¼ã—å…¥ã‚Œ" style={inp} list="loc-list" /><datalist id="loc-list">{Array.from(new Set(items.map(i=>i.location))).map(l=><option key={l} value={l}/>)}</datalist></div>
                <div style={{ display:"flex", gap:8 }}>
                  <div style={{ flex:2 }}><div style={{ fontSize:"0.65rem", color:"rgba(255,255,255,0.4)", marginBottom:5 }}>æ•°é‡</div><input type="number" value={form.qty} onChange={e=>setForm({...form,qty:e.target.value})} placeholder="0" min="0" style={inp} /></div>
                  <div style={{ flex:1 }}><div style={{ fontSize:"0.65rem", color:"rgba(255,255,255,0.4)", marginBottom:5 }}>å˜ä½</div><input value={form.unit} onChange={e=>setForm({...form,unit:e.target.value})} placeholder="æœ¬" style={inp} /></div>
                </div>
              </div>
              <div style={{ display:"flex", gap:10, marginTop:20 }}>
                <button onClick={()=>setShowForm(false)} style={{ flex:1, padding:11, background:"transparent", border:"1px solid rgba(255,255,255,0.15)", borderRadius:8, color:"rgba(255,255,255,0.4)", fontSize:"0.82rem", cursor:"pointer" }}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onClick={submitForm} disabled={!form.name.trim()||!form.expiry} style={{ flex:2, padding:11, background:"linear-gradient(135deg,#1a6cff,#00aaff)", border:"none", borderRadius:8, color:"#fff", fontSize:"0.82rem", fontWeight:700, cursor:"pointer" }}>{editItem ? "æ›´æ–°ã™ã‚‹" : "ç™»éŒ²ã™ã‚‹"}</button>
              </div>
            </div>
          )}
          {deleteId && !showForm && (
            <div style={{ background:"linear-gradient(135deg,#0a1628,#0d1f38)", border:"1px solid rgba(255,80,80,0.3)", borderRadius:16, padding:24, width:"100%", maxWidth:300, textAlign:"center" }}>
              <div style={{ fontSize:"1.6rem", marginBottom:10 }}>ğŸ—‘</div>
              <div style={{ fontSize:"0.88rem", marginBottom:6 }}>å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</div>
              <div style={{ fontSize:"0.72rem", color:"rgba(255,255,255,0.3)", marginBottom:20 }}>ã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“</div>
              <div style={{ display:"flex", gap:10 }}>
                <button onClick={()=>setDeleteId(null)} style={{ flex:1, padding:10, background:"transparent", border:"1px solid rgba(255,255,255,0.15)", borderRadius:8, color:"rgba(255,255,255,0.4)", fontSize:"0.8rem", cursor:"pointer" }}>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onClick={()=>deleteItem(deleteId)} style={{ flex:1, padding:10, background:"linear-gradient(135deg,#ff3355,#cc1133)", border:"none", borderRadius:8, color:"#fff", fontSize:"0.8rem", fontWeight:700, cursor:"pointer" }}>å‰Šé™¤</button>
              </div>
            </div>
          )}
        </div>
      )}

      <div style={{ maxWidth:520, margin:"0 auto", paddingTop:40 }}>
        <div style={{ marginBottom:24 }}>
          <div style={{ fontSize:"0.6rem", letterSpacing:"0.4em", color:"rgba(100,180,255,0.5)", marginBottom:6 }}>EMERGENCY STOCK</div>
          <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <h1 style={{ fontSize:"1.7rem", fontWeight:700, color:"#90c8f8", letterSpacing:"0.05em", textShadow:"0 0 20px rgba(100,180,255,0.3)" }}>ä¿å­˜é£Ÿç®¡ç†</h1>
            <button onClick={openAdd} style={{ padding:"10px 18px", background:"linear-gradient(135deg,#1a6cff,#00aaff)", border:"none", borderRadius:10, color:"#fff", fontSize:"0.82rem", fontWeight:700, cursor:"pointer", boxShadow:"0 4px 16px rgba(26,108,255,0.35)" }}>+ è¿½åŠ </button>
          </div>
          <div style={{ display:"flex", gap:10, marginTop:14 }}>
            <div style={{ flex:1, background:"rgba(255,255,255,0.04)", border:"1px solid rgba(255,255,255,0.08)", borderRadius:10, padding:"10px 14px" }}>
              <div style={{ fontSize:"0.6rem", color:"rgba(255,255,255,0.35)", marginBottom:3 }}>ç™»éŒ²æ•°</div>
              <div style={{ fontSize:"1.3rem", fontWeight:700, color:"#90c8f8" }}>{items.length}<span style={{ fontSize:"0.7rem", color:"rgba(255,255,255,0.4)", marginLeft:3 }}>å“</span></div>
            </div>
            <div style={{ flex:1, background: expiringSoon > 0 ? "rgba(255,80,80,0.08)" : "rgba(255,255,255,0.04)", border:`1px solid ${expiringSoon > 0 ? "rgba(255,80,80,0.25)" : "rgba(255,255,255,0.08)"}`, borderRadius:10, padding:"10px 14px" }}>
              <div style={{ fontSize:"0.6rem", color:"rgba(255,255,255,0.35)", marginBottom:3 }}>6ãƒ¶æœˆä»¥å†…</div>
              <div style={{ fontSize:"1.3rem", fontWeight:700, color: expiringSoon > 0 ? "#ff6060" : "#64dc78" }}>{expiringSoon}<span style={{ fontSize:"0.7rem", color:"rgba(255,255,255,0.4)", marginLeft:3 }}>å“</span></div>
            </div>
            <div style={{ flex:1, background:"rgba(255,255,255,0.04)", border:"1px solid rgba(255,255,255,0.08)", borderRadius:10, padding:"10px 14px" }}>
              <div style={{ fontSize:"0.6rem", color:"rgba(255,255,255,0.35)", marginBottom:3 }}>ä¿ç®¡å ´æ‰€</div>
              <div style={{ fontSize:"1.3rem", fontWeight:700, color:"#90c8f8" }}>{new Set(items.map(i=>i.location)).size}<span style={{ fontSize:"0.7rem", color:"rgba(255,255,255,0.4)", marginLeft:3 }}>ç®‡æ‰€</span></div>
            </div>
          </div>
        </div>

        <div style={{ display:"flex", gap:8, marginBottom:12, flexWrap:"wrap" }}>
          {allLocations.map(loc => (
            <button key={loc} onClick={()=>setFilter(loc)} style={{ padding:"6px 12px", background: filter===loc ? "rgba(100,180,255,0.15)" : "rgba(255,255,255,0.04)", border:`1px solid ${filter===loc ? "rgba(100,180,255,0.4)" : "rgba(255,255,255,0.1)"}`, borderRadius:20, color: filter===loc ? "#90c8f8" : "rgba(255,255,255,0.4)", fontSize:"0.72rem", cursor:"pointer" }}>{loc}</button>
          ))}
        </div>

        <div style={{ display:"flex", gap:6, marginBottom:16, alignItems:"center" }}>
          <span style={{ fontSize:"0.62rem", color:"rgba(255,255,255,0.3)" }}>ä¸¦ã³æ›¿ãˆï¼š</span>
          {[["expiry","æœŸé™é †"],["name","åå‰é †"],["location","å ´æ‰€é †"]].map(([v,l])=>(
            <button key={v} onClick={()=>setSort(v)} style={{ padding:"4px 10px", background: sort===v ? "rgba(100,180,255,0.12)" : "transparent", border:`1px solid ${sort===v ? "rgba(100,180,255,0.3)" : "rgba(255,255,255,0.1)"}`, borderRadius:6, color: sort===v ? "#90c8f8" : "rgba(255,255,255,0.35)", fontSize:"0.68rem", cursor:"pointer" }}>{l}</button>
          ))}
        </div>

        {displayed.length === 0 ? (
          <div style={{ textAlign:"center", padding:"60px 20px", color:"rgba(255,255,255,0.2)", fontSize:"0.85rem" }}>
            <div style={{ fontSize:"2.5rem", marginBottom:12 }}>ğŸ“¦</div>ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“
          </div>
        ) : (
          <div style={{ display:"flex", flexDirection:"column", gap:8 }}>
            {displayed.map(item => {
              const months = getMonthsUntilExpiry(item.expiry);
              const isRed = months <= 6; const isExpired = months < 0;
              return (
                <div key={item.id} className="item-card" style={{ background: isExpired ? "rgba(255,50,50,0.06)" : isRed ? "rgba(255,80,80,0.04)" : "rgba(255,255,255,0.03)", border:`1px solid ${isExpired ? "rgba(255,50,50,0.25)" : isRed ? "rgba(255,80,80,0.18)" : "rgba(255,255,255,0.08)"}`, borderRadius:12, padding:"14px 16px", display:"flex", alignItems:"center", gap:12, transition:"border-color 0.2s" }}>
                  <div style={{ flex:1, minWidth:0 }}>
                    <div style={{ fontWeight:700, fontSize:"0.92rem", color: isRed ? "#ffaaaa" : "#e8f0f8", marginBottom:5, overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap" }}>{item.name}</div>
                    <div style={{ display:"flex", alignItems:"center", gap:8, flexWrap:"wrap" }}>
                      <ExpiryBadge expiry={item.expiry} />
                      <span style={{ fontSize:"0.7rem", color:"rgba(255,255,255,0.35)" }}>ğŸ“ {item.location}</span>
                      {item.qty > 0 && <span style={{ fontSize:"0.7rem", color:"rgba(255,255,255,0.35)" }}>Ã— {item.qty}{item.unit}</span>}
                    </div>
                  </div>
                  <div style={{ display:"flex", gap:6, flexShrink:0 }}>
                    <button onClick={()=>openEdit(item)} style={{ padding:"6px 10px", background:"rgba(100,180,255,0.08)", border:"1px solid rgba(100,180,255,0.2)", borderRadius:7, color:"rgba(100,180,255,0.7)", fontSize:"0.72rem", cursor:"pointer" }}>âœ</button>
                    <button onClick={()=>setDeleteId(item.id)} style={{ padding:"6px 10px", background:"rgba(255,80,80,0.08)", border:"1px solid rgba(255,80,80,0.2)", borderRadius:7, color:"rgba(255,100,100,0.7)", fontSize:"0.72rem", cursor:"pointer" }}>ğŸ—‘</button>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<StorageTracker />);
</script>
</body>
</html>
